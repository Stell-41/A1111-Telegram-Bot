# Telegram-бот для генерации изображений с помощью Automatic1111

Этот проект представляет собой Telegram-бота, который позволяет пользователям генерировать изображения с помощью локально запущенного API Automatic1111. Бот поддерживает управление настройками генерации, сохранение промтов и работу с предустановленными данными о персонажах для создания сложных комбинаций промтов.

## Особенности

* **Генерация изображений:** Отправка запросов на генерацию изображений в API Automatic1111 (txt2img).
* **Управление настройками:** Пользователь может настраивать параметры генерации, такие как `steps`, `cfg_scale`, `width`, `height`, `sampler_name` и `model_name`.
* **Сохранение промтов:** Возможность сохранять до 10 любимых промтов для быстрого доступа.
* **Логика для нескольких персонажей:** Система позволяет генерировать сложные промты, объединяя теги от нескольких выбранных персонажей, включая обязательные и опциональные теги.
* **Администрирование:** Поддерживается роль администратора с доступом к расширенным функциям.
* **Безопасность:** Встроенный middleware для контроля доступа к боту по `user_id`.

## Требования

Для запуска бота необходимы:

* Python 3.8+
* Активный аккаунт в Telegram и токен для бота.
* Установленный и запущенный сервер Automatic1111 с включенным API.

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone [https://github.com/yourusername/your-repo-name.git](https://github.com/yourusername/your-repo-name.git)
    cd your-repo-name
    ```

2.  **Установите зависимости Python:**
    ```bash
    pip install -r requirements.txt
    ```
    [cite_start]Зависимости включают `aiogram` для работы с Telegram API и `requests` для взаимодействия с Automatic1111 API[cite: 1].

3.  **Настройка конфигурации:**
    * Создайте файл `config.py` на основе `config_example.py`.
    * Заполните `BOT_TOKEN`, `ADMIN_IDS` и `A1111_API_URL`.
        * `BOT_TOKEN`: Получите у `@BotFather` в Telegram.
        * `ADMIN_IDS`: Ваш числовой ID в Telegram. Его можно узнать у `@userinfobot`.
        * `A1111_API_URL`: URL вашего сервера Automatic1111. Если бот запущен на том же ПК, что и Automatic1111, используйте `http://127.0.0.1:7860`.

4.  **Подготовка данных:**
    * Файл `data/characters.json` используется для хранения данных о персонажах. Если он отсутствует, бот будет использовать `data/characters_example.json`.
    * Файл `data/user_settings.json` будет создан автоматически при первом запуске для хранения пользовательских данных.

5.  **Запуск бота:**
    ```bash
    python main.py
    ```
    Бот запустится в режиме `polling` и будет готов принимать команды.

## Структура проекта

* `main.py`: Основная точка входа для запуска бота.
* `config.py`: Файл конфигурации для токена бота, ID администратора и URL API.
* [cite_start]`requirements.txt`: Список зависимостей Python[cite: 1].
* `bot/`: Директория с обработчиками (`handlers`) и middleware бота.
* `services/`: Директория с основной бизнес-логикой:
    * `a1111_api_service.py`: Функции для взаимодействия с API Automatic1111 (генерация, получение списка моделей, установка активной модели).
    * `prompt_logic.py`: Логика для загрузки данных о персонажах и генерации сложных промтов на основе их тегов.
    * `user_data_service.py`: Функции для загрузки, сохранения и управления пользовательскими данными и сохраненными промтами.
* `data/`: Директория для хранения файлов с данными: `user_settings.json` и `characters.json`.

## Используемые технологии

* [cite_start]**aiogram 3:** Фреймворк для асинхронного взаимодействия с Telegram Bot API[cite: 1].
* [cite_start]**requests:** Библиотека для выполнения HTTP-запросов к Automatic1111 API[cite: 1].
* **Automatic1111 Web UI:** Сервер для генерации изображений на основе Stable Diffusion.

## Лицензия

Этот проект распространяется под лицензией MIT.